<?xml version="1.0" encoding="utf-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.11 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC8446 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8446.xml">
<!ENTITY RFC2119 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC8174 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC2535 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2535.xml">
<!ENTITY RFC3445 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3445.xml">
<!ENTITY RFC2136 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2136.xml">
<!ENTITY RFC2931 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2931.xml">
<!ENTITY RFC3007 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3007.xml">
<!ENTITY RFC7558 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7558.xml">
<!ENTITY RFC6763 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6763.xml">
]>

<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>

<rfc ipr="trust200902" docName="draft-pusateri-dnsop-private-subdomains-00" category="exp">

  <front>
    <title>Private DNS Subdomains</title>

    <author initials="T." surname="Pusateri" fullname="Tom Pusateri">
      <organization>Unaffiliated</organization>
      <address>
        <postal>
          <street></street>
          <city>Raleigh</city>
          <code>NC 27608</code>
          <country>USA</country>
        </postal>
        <phone>+1 (919) 867-1330</phone>
        <email>pusateri@bangj.com</email>
      </address>
    </author>

    <date year="2019"/>

    <area>Internet</area>
    <workgroup>DNSOP Working Group</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This document describes a method of providing private DNS subdomains such that each subdomain can be shared among multiple devices of a single owner or group. A private subdomain can be used for sharing personal services while increasing privacy and limiting knowledge of scarce resources.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>Section 6.6 of <xref target="RFC7558"/> highlights the privacy risks of DNS service announcements in clear text. While there has been a long focus on access control to private services including the use of encryption and authentication through TLS <xref target="RFC8446"/> for connections, the DNS-SD announcements <xref target="RFC6763"/> themselves may leak private information including but not limited to device types and versions, enabled services on the device subject to attack, personal names and identifiers used for tracking, etc.</t>

<t>Some services are meant to be advertised and used freely by devices on the link but other services are restricted to an owner or group and these services are announced publicly as a side effect of the current service discovery deployment.</t>

<t>This document defines a method for collaborating devices to share private services with one another but without revealing the existence of these services in a public way. This provides an additional layer of privacy protection for an individual’s devices or those of a defined group sharing a common purpose.</t>

<t>The additional privacy is achieved by creating private subdomains that require a private key for bidirectional access to DNS queries and responses for the zone.</t>

<t>This document defines a subdomain hierarchy for providers to enable this feature as well as a mechanism for interoperable transfers to and from the subdomain. This includes creating and destroying the subdomains, adding and removing records through DNS Update, and requires private authenticated queries.</t>

</section>
<section anchor="requirements-language" title="Requirements Language">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL
NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”,
“MAY”, and “OPTIONAL” in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
appear in all capitals, as shown here.
These words may also appear in this document in
lower case as plain English words, absent their normative meanings.</t>

</section>
<section anchor="subdomain-operations" title="Subdomain Operations">

<t>An administrative domain provider will enable private subdomains by creating a base subdomain at <spanx style="verb">_pvt.&lt;domain&gt;.</spanx> In addition to the SOA and NS records, a public KEY record <xref target="RFC2535"/>, <xref target="RFC3445"/> MUST be created at the apex which is openly available for queries. This public key will be used for message encryption relating to the maintenance of private subdomains.</t>

<t>The Zone bit for all KEY records used in this specification MUST be set to 0. The protocol value for the KEY record is set to DNSSEC (3) and the algorithm value is taken from the available algorithms defined in the IANA DNS Security Algorithm Numbers. Only algorithms that can be used for encryption are eligible for use in the KEY record for this purpose.</t>

<section anchor="zone-creation" title="Zone Creation">

<t>A subdomain is created by the owner in an administrative domain for which the owner has a trusted relationship. For instance, if a user has services provided by an administrative domain and that user has been assigned a user name or account at that domain, the user could then uniquely claim ownership of the subdomain <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx></t>

<t>The administrative domain can use any means it finds sufficient to verify the trusted relationship with the user including RADIUS, AAA, email verification, or some other method not described here which may include enabling the service on a per-user basis.</t>

<t>The user can then create the subdomain by sending an UPDATE <xref target="RFC2136"/> to the MNAME of the SOA record for <spanx style="verb">_pvt.&lt;domain&gt;.</spanx> containing a new KEY record for the zone <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> The KEY record contains a public key that will later be used by the administrative domain to verify signed requests and send encrypted responses. If this zone already exists, the UPDATE fails with RCODE YXRRSet. If the zone does not exist, the user has successfully claimed the zone and all subsequent operations by the user will require knowledge of the private key associated with the registered public key in the KEY record. The user can distribute this private key to any or all of its devices for access to the private subdomain.</t>

<t>In response, appropriate NS records for <spanx style="verb">&lt;user&gt;</spanx> will be created in the <spanx style="verb">_pvtr.&lt;domain&gt;.</spanx> and a new SOA record <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> with appropriate record fields will also be created along side the new KEY record submitted by the user. The authoritative servers for the new <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> will be managed by the administrative domain provider.</t>

<t>At this point, the owner has knowledge of the public key of <spanx style="verb">_pvt.&lt;domain&gt;.</spanx> and the administrative domain has knowledge of the public key of <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> All subsequent operations for the subdomain <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> use encrypted records based on the public key of the message receiver. All operations by the owner MUST included a signature using the private key which can be verified by the receiver using the owners public key. In this way, the records are only ever updated or revealed to an authorized user.</t>

</section>
<section anchor="adding-removing-resource-records" title="Adding / Removing Resource Records">

<t>Once the zone is created, the user can begin adding or removing records to the <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;</spanx> subdomain through additional UPDATE messages for the zone. The subdomain in the Zone section of the UPDATE appears as usual in plain text. However, individual records in the Update section of the message are encrypted with the administrative domain’s public KEY found at <spanx style="verb">_pvt.&lt;domain&gt;.</spanx></t>

<t>To ensure zone additions and deletions are from the subdomain owner, the UPDATE message must be signed with the owner’s private key and the signature included in the additional data section in the form of a SIG(0) record <xref target="RFC2931"/>. The owner MUST sign the encrypted form of the records in the Update section in order for the receiver to validate the UPDATE message before attempting to decrypt the records contained within. More information about authenticating UPDATE messages can be found in <xref target="RFC3007"/>.</t>

<t>The administrative domain provider can then use the private key associated with the public key stored in the KEY record at <spanx style="verb">_pvt.&lt;domain&gt;.</spanx> to individually decrypt the resource records contained in the Update section. If the records can be successfully decrypted, they are added to, or removed from, the <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx> zone. If the records cannot be decrypted, the receiver MUST return FORMERR. See section 2.5.2 of <xref target="RFC2136"/> for the specifics of adding or removing records in the Update section.</t>

<t>In order to change the KEY record at the apex of the zone, the old KEY record should be added to the Prerequisite section and the new KEY record in the Update section. The entire UPDATE message MUST be signed by placing the SIG(0) signature record in the Additional data section.</t>

<t>This is useful for changing the algorithm or key length for the public/private key pair.</t>

<t>If instead the private key associated with the public key in the KEY record has been compromised, the user should contact the administrative domain out of band to verify authenticity and replace the KEY record through a process established by the provider.</t>

</section>
<section anchor="zone-destruction" title="Zone Destruction">

<t>When the owner is ready to destroy the subdomain <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx>, it can do so by deleting the KEY record at the apex through an UPDATE message. As above, the UPDATE message additional data section MUST contain a SIG(0) signature over the entire message. Once validated, the zone will be removed along with the NS records for <spanx style="verb">&lt;user&gt;</spanx> in the <spanx style="verb">_pvt.&lt;domain&gt;</spanx> zone. The KEY record containing the public key is not encrypted.</t>

<t>The owner is free to destroy and re-create the subdomain as needed for as long as the relationship continues with the administrative domain.</t>

</section>
</section>
<section anchor="querying-resource-records" title="Querying Resource Records">

<t>Only the owner and the administrative domain provider know the true contents of the records. Queries must be made through direct connections to an authoritative server for the subdomain over a TLS connection. If the authoritative server also provides connections over UDP or TCP without TLS, queries for records in private zones over non-TLS connections MUST return an rcode of REFUSED.</t>

<section anchor="signed-requests" title="Signed Requests">

<t>All queries MUST be signed with the private key of the owner. The signature MUST be in the Additional records section in the form of a SIG(0) record. If a query is received that is not signed or cannot be verified with the public key in the KEY record at the apex of the <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx>, a response containing the question as received with an RCODE of REFUSED with no answers MUST be returned. The Authority section of the response MUST contain the SOA record for the <spanx style="verb">&lt;user&gt;._pvt.&lt;domain&gt;.</spanx></t>

<t>Authoritative servers MUST verify the signature in the query before returning the results.</t>

</section>
</section>
<section anchor="responses" title="Responses">

</section>
<section anchor="security-considerations" title="Security Considerations">

<t><vspace blankLines='999' /></t>

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC8446;
&RFC2119;
&RFC8174;
&RFC2535;
&RFC3445;
&RFC2136;
&RFC2931;
&RFC3007;


    </references>

    <references title='Informative References'>

&RFC7558;
&RFC6763;


    </references>




  </back>

<!-- ##markdown-source:
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

-->

</rfc>

